!function(a){function b(a,b){function d(a){if(m.ready){h.addEventListener("touchmove",e,!1),h.addEventListener("touchend",i,!1),s={};var b,c,d,g,j=a.changedTouches;for(b=0;b<j.length;b++)c=j[b],f(p,c)&&(d=c.clientX-p.left,g=c.clientY-p.top),s[c.identifier]={touch:c,startX:d,startY:g}}}function e(a){var c,d,e,g=a.changedTouches;for(c=0;c<g.length;c++)if(d=g[c],e=s[d.identifier],e&&f(p,d)){var h=d.clientX-p.left,i=d.clientY-p.top;e.started?r.lineTo(h,i):(r.beginPath(),e.startX&&e.startY?(r.moveTo(e.startX,e.startY),r.lineTo(h,i)):r.moveTo(h,i),e.started=!0),r.stroke()}b.continuousCheck&&k()}function i(){k(),h.removeEventListener("touchmove",e,!1),h.removeEventListener("touchend",i,!1)}function k(){!m.completed&&g(r,p,m.checkArea)>b.thresholdPercent&&(m.ready=!1,m.completed=!0,q.addEventListener(j+"TransitionEnd",function(a){q.removeEventListener(a.type,arguments.callee),q.style.webkitTransition="",q.style.display="none",c(o,b.result),b.onFinish&&b.onFinish()}),q.style.webkitTransition="opacity 0.6s ease",q.style.opacity=0)}var m=this;for(var n in b)l[n]=b[n];b=m.config=l,"string"==typeof a&&(a=document.querySelector(a)),a.style.cssText+="relative",m.container=a;var o=m.wrapper=h.createElement("div");o.style.cssText="width:100%;height:100%;position:absolute;left:0;top:0;",a.appendChild(o);var p=m.region=a.getBoundingClientRect(),q=m.canvas=document.createElement("canvas");q.width=p.width,q.height=p.height,q.style.cssText="width:"+q.width+"px;height:"+q.height+";position:absolute;top:0;left:0;",a.appendChild(q);var r=m.context=q.getContext("2d");h.addEventListener("touchstart",d,!1),m.refresh();var s}function c(a,b){a&&b&&("string"==typeof b?a.innerHTML=b:(a.innerHTML="",a.appendChild(b)))}function d(a,b){a.globalCompositeOperation="destination-out",a.lineJoin="round",a.lineCap="round",a.strokeStyle="rgba(0, 0, 0, 255)",a.lineWidth=b.lineWidth}function e(a,b,c){"string"==typeof c?c=h.querySelectorAll(c):c instanceof HTMLElement&&(c=[c]),c&&0!==c.length||(c=[a]);var d,e,f,g,i,j=[];for(d=0;d<c.length;d++)rect=c[d].getBoundingClientRect(),rect&&rect.width>0&&rect.height>0&&(e=Math.max(0,rect.left-b.left),f=Math.max(0,rect.top-b.top),g=b.width-e-Math.max(0,b.right-rect.right),i=b.height-f-Math.max(0,b.bottom-rect.bottom),j.push([e,f,g,i]));return j}function f(a,b){return b.clientX>a.left&&b.clientX<a.right&&b.clientY>a.top&&b.clientY<a.bottom}function g(a,b,c){var d,e,f,g=0,h=0;for(d=0;d<c.length;d++){e=c[d],f=a.getImageData(e[0],e[1],e[2],e[3]).data;for(var i=0;i<f.length;i+=4)g++,0===f[i+3]&&h++}return h/g}var h=(window,document),i=navigator.userAgent,j=/webkit/i.test(i)?"webkit":/firefox/i.test(i)?"Moz":/msie/i.test(i)?"ms":"",k={},l={coverColor:"#fff",coverAlpha:1,thresholdPercent:.7,continuousCheck:!1,lineWidth:30},m=b.prototype;m.refresh=function(a){var b=this;for(var d in a)b.config[d]=a[d];a=b.config,b.ready=!1,b.completed=!1;var e=a.content;e&&(c(b.wrapper,e),b._drawCover())},m._drawCover=function(){function a(){g.globalCompositeOperation="source-over";var a=h.image;if(a){var i=a.width,j=a.height,k=h.x,l=h.y;(void 0===k||"center"===k)&&(k=f.width-i>>1),(void 0===l||"center"===l)&&(l=f.height-j>>1),g.drawImage(a,k,l,i,j)}var m=c.coverTitle;if(m){g.globalAlpha=1,g.font=m.font||"20px Arial",g.fillStyle=m.color||"#000",g.textBaseline="middle";var k=m.x,l=m.y;if(void 0===k||"center"===k){var n=g.measureText(m.text).width;k=f.width-n>>1}(void 0===l||"center"===l)&&(l=f.height>>1),g.fillText(m.text,k,l),g.globalAlpha=c.coverAlpha}d(g,c),b.checkArea=e(f,b.region,c.checkElement),f.style.display="",f.style.opacity=1,b.ready=!0,c.onReady&&c.onReady()}var b=this,c=b.config,f=(b.container,b.canvas),g=b.context;g.clearRect(0,0,f.width,f.height),g.globalCompositeOperation="source-over",g.globalAlpha=c.coverAlpha,g.fillStyle=c.coverColor,g.fillRect(0,0,f.width,f.height);var h=c.coverImage||{};if("string"==typeof h?h={src:h}:(h instanceof Image||i instanceof HTMLImageElement)&&(h={src:h.src,image:h}),!h.src&&h.image?h.src=h.image.src:h.src&&!h.image&&(h.image=k[h.src]),!h.image&&h.src){var i=new Image;i.crossOrigin="Anonymous",i.onload=function(){i.onload=null,h.image=k[h.src]=i,a()},i.src=h.src}else k[h.src]=h.image,a()},a.ScratchCard=b}(window.ix||(window.ix={}));